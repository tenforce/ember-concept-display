Index: test/helpers/generate-mock-run.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- test/helpers/generate-mock-run.js	(revision )
+++ test/helpers/generate-mock-run.js	(revision )
@@ -0,0 +1,40 @@
+module.exports = function generateMockRun(mockedCommand, mockedCommandCallback) {
+  var mockedCommands = [];
+  if (typeof arguments[0] === 'string') {
+    mockedCommands.push({ command: mockedCommand, callback: mockedCommandCallback });
+  } else {
+    mockedCommands = arguments[0];
+  }
+
+  return function mockRun(command, args, opts) {
+    var matchingCmd = mockedCommands.find(function(mockedCmd) {
+      var mockedCommandArgs = mockedCmd.command.split(' ');
+      return mockedCommandIsEmberAndArgumentsMatch(mockedCommandArgs, command, args) || commandIsMocked(mockedCommandArgs, command, args);
+    });
+
+    if (matchingCmd) {
+      return matchingCmd.callback(command, args, opts);
+    } else {
+      var regularRun = require('../../lib/utils/run');
+      return regularRun.apply(this, arguments);
+    }
+  };
+};
+
+function mockedCommandIsEmberAndArgumentsMatch(mockedCommandArgs, command, args) {
+  return (mockedCommandArgs[0] === 'ember') && (command == 'node' && args && (args[0].indexOf('ember') > -1) && arrayContains(args.slice(1)[0], mockedCommandArgs.slice(1)));
+}
+
+function commandIsMocked(mockedCommandArgs, command, args) {
+  return (mockedCommandArgs[0] === command && arrayContains(args, mockedCommandArgs.slice(1)));
+}
+
+function arrayContains(firstArr, secondArr) {
+  var flag = true;
+  secondArr.forEach(function(item, index) {
+    if (firstArr[index] !== item) {
+      flag = false;
+    }
+  });
+  return flag;
+}
Index: lib/utils/run-command.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- lib/utils/run-command.js	(date 1454649863000)
+++ lib/utils/run-command.js	(revision )
@@ -4,13 +4,20 @@
 var run           = require('./run');
 
 module.exports = function(root, commandArgs, opts) {
-  var options;
-  return findEmberPath(root)
-    .then(function(emberPath) {
-      options = extend({cwd: root}, opts);
-      return run('node', [emberPath, commandArgs], options);
-    })
-    .then(function() {
+  var options = extend({cwd: root}, opts);
+  var runPromise;
+  var command = commandArgs[0];
+  var actualArgs = commandArgs.slice(1);
+
+  if (command === 'ember') {
+    runPromise = findEmberPath(root).then(function(emberPath) {
+      return run('node', [emberPath, actualArgs], options);
+    });
+  } else {
+    runPromise = run(command, actualArgs, options);
+  }
+
+  return runPromise.then(function() {
       return RSVP.resolve(true);
     })
     .catch(function(errorCode) {
Index: lib/commands/index.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- lib/commands/index.js	(date 1454649863000)
+++ lib/commands/index.js	(revision )
@@ -1,5 +1,6 @@
 module.exports = {
   try:         require('./try'),
   'try:testall': require('./testall'),
-  'try:reset':   require('./reset')
+  'try:reset':   require('./reset'),
+  'try:each': require('./try-each')
 };
Index: test/fixtures/package.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- test/fixtures/package.json	(date 1454649863000)
+++ test/fixtures/package.json	(revision )
@@ -1,6 +1,15 @@
 {
   "name": "a-test-project",
   "devDependencies": {
-    "ember-data": "2.3.3"
-  }
+    "ember-feature-flags": "2.0.0"
+  },
+  "repository": "kategengler/ember-try",
+  "private": true,
+  "version": "1.0.0",
+  "description": "A test thing",
+  "main": "index.js",
+  "scripts": {
+    "test": "echo \"Error: no test specified\" && exit 1"
+  },
+  "author": ""
 }
Index: test/tasks/try-each-test.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- test/tasks/try-each-test.js	(date 1454649863000)
+++ test/tasks/try-each-test.js	(revision )
@@ -9,6 +9,7 @@
 
 /* The first two of the tests in this file intentionally DO NOT stub dependency manager adapter*/
 var StubDependencyAdapter = require('../helpers/stub-dependency-manager-adapter');
+var generateMockRun = require('../helpers/generate-mock-run');
 
 var remove = RSVP.denodeify(fs.remove);
 var root = process.cwd();
@@ -121,15 +122,9 @@
     it('succeeds when scenario\'s tests succeed', function() {
       this.timeout(15000);
 
-      var mockedRun = function(_, args) {
-        if (args[1].indexOf('test') > -1) {
+      var mockedRun = generateMockRun('ember test', function() {
-          return RSVP.resolve(0);
+        return RSVP.resolve(0);
-        } else {
-          var regularRun = require('../../lib/utils/run');
-          return regularRun.apply(this, arguments);
-        }
-      };
-
+      });
       mockery.registerMock('./run', mockedRun);
 
       var output = [];
@@ -169,19 +164,14 @@
       this.timeout(15000);
 
       var runTestCount = 0;
-      var mockedRun = function(_, args) {
-        if (args[1].indexOf('test') > -1) {
+      var mockedRun = generateMockRun('ember test', function() {
-          runTestCount++;
-          if (runTestCount == 1) {
-            return RSVP.reject(1);
-          } else {
-            return RSVP.resolve(0);
-          }
+        runTestCount++;
+        if (runTestCount == 1) {
+          return RSVP.reject(1);
+        } else {
+          return RSVP.resolve(0);
+        }
-        } else {
-          var regularRun = require('../../lib/utils/run');
-          return regularRun.apply(this, arguments);
-        }
-      };
+      });
 
       mockery.registerMock('./run', mockedRun);
 
@@ -223,14 +213,9 @@
     it('succeeds when scenario\'s tests succeed', function() {
       this.timeout(300000);
 
-      var mockedRun = function(cmd, args, opts) {
-        if (args && args.length > 1 && args[1].indexOf('test') > -1) {
+      var mockedRun = generateMockRun('ember test', function() {
-          return RSVP.resolve(0);
+        return RSVP.resolve(0);
-        } else {
-          var regularRun = require('../../lib/utils/run');
-          return regularRun.apply(this, arguments);
-        }
-      };
+      });
 
       mockery.registerMock('./run', mockedRun);
 
@@ -270,19 +255,14 @@
       this.timeout(300000);
 
       var runTestCount = 0;
-      var mockedRun = function(_, args) {
-        if (args && args.length > 1 && args[1].indexOf('test') > -1) {
+      var mockedRun = generateMockRun('ember test', function() {
-          runTestCount++;
-          if (runTestCount == 1) {
-            return RSVP.reject(1);
-          } else {
-            return RSVP.resolve(0);
-          }
+        runTestCount++;
+        if (runTestCount == 1) {
+          return RSVP.reject(1);
+        } else {
+          return RSVP.resolve(0);
+        }
-        } else {
-          var regularRun = require('../../lib/utils/run');
-          return regularRun.apply(this, arguments);
-        }
-      };
+      });
 
       mockery.registerMock('./run', mockedRun);
 
@@ -335,17 +315,12 @@
         }]
       };
       var passedInOptions = false;
-      var mockedRun = function(_, args, options) {
-        if (args[1].indexOf('serve') > -1) {
+      var mockedRun = generateMockRun('ember serve', function(command, args, options) {
-          if(options.timeout && options.timeout.length == 20000 && options.timeout.isSuccess) {
+        if (options.timeout && options.timeout.length == 20000 && options.timeout.isSuccess) {
-            passedInOptions = true;
-          }
-          return RSVP.resolve(0);
+          passedInOptions = true;
+        }
+        return RSVP.resolve(0);
-        } else {
-          var regularRun = require('../../lib/utils/run');
-          return regularRun.apply(this, arguments);
-        }
-      };
+      });
 
       mockery.registerMock('./run', mockedRun);
 
@@ -363,7 +338,7 @@
         ui: {writeLine: outputFn},
         project: {root: tmpdir},
         config: config,
-        commandArgs: ['serve'],
+        commandArgs: ['ember', 'serve'],
         commandOptions: { timeout: { length: 20000, isSuccess: true }},
         dependencyManagerAdapters: [new StubDependencyAdapter()],
         _exit: mockedExit
@@ -379,58 +354,121 @@
       });
     });
 
+    describe('configurable command', function() {
-    it('allows passing in of the command to run', function() {
-      // With stubbed dependency manager, timing out is warning for accidentally not using the stub
-      this.timeout(100);
+      it('allows passing in of the command to run', function() {
+        // With stubbed dependency manager, timing out is warning for accidentally not using the stub
+        this.timeout(100);
 
-      var config = {
+        var config = {
+          command: 'ember test-this',
-        scenarios: [{
-          name: 'first',
-          dependencies: {
-            ember: '1.13.0'
-          }
-        }]
-      };
-      var ranPassedInCommand = false;
+          scenarios: [{
+            name: 'first',
+            dependencies: {
+              ember: '1.13.0'
+            }
+          }]
+        };
+        var ranPassedInCommand = false;
-      var mockedRun = function(_, args) {
-        if (args[1].indexOf('serve') > -1) {
+        var mockedRun = generateMockRun('ember serve', function() {
           ranPassedInCommand = true;
           return RSVP.resolve(0);
-        } else {
-          var regularRun = require('../../lib/utils/run');
-          return regularRun.apply(this, arguments);
+        });
+        mockery.registerMock('./run', mockedRun);
+
+        var output = [];
+        var outputFn = function(log) {
+          output.push(log);
+        };
+
+        var mockedExit = function(code) {
+          code.should.equal(0, 'exits 0 when all scenarios succeed');
+        };
+
+        var TryEachTask = require('../../lib/tasks/try-each');
+        var tryEachTask = new TryEachTask({
+          ui: {writeLine: outputFn},
+          project: {root: tmpdir},
+          config: config,
+          commandArgs: ['ember', 'serve'],
+          dependencyManagerAdapters: [new StubDependencyAdapter()],
+          _exit: mockedExit
+        });
+
+        return tryEachTask.run(config.scenarios, {}).then(function() {
+          output.should.containEql('Scenario first: SUCCESS');
+          ranPassedInCommand.should.equal(true, 'Should run the passed in command');
+        }).catch(function(err) {
+          console.log(err);
+          true.should.equal(false, 'Assertions should run');
+        });
+      });
+      it('uses command from config', function() {
+        // With stubbed dependency manager, timing out is warning for accidentally not using the stub
+        this.timeout(100);
+
+        var config = {
+          command: 'ember test --test-port=2345',
+          scenarios: [{
+            name: 'first',
+            dependencies: {
+              ember: '1.13.0'
-        }
+            }
+          },{
+            name: 'different',
+            command: 'npm run-script different',
+            dependencies: {
+              ember: '2.0.0'
+            }
+          }]
-      };
+        };
 
+        var ranDefaultCommand = false;
+        var ranScenarioCommand = false;
+        var mockedRun = generateMockRun([{
+          command: 'ember test --test-port=2345',
+          callback: function() {
+            ranDefaultCommand = true;
+            return RSVP.resolve(0);
+          }
+        },{
+          command: 'npm run-script different',
+          callback: function() {
+            ranScenarioCommand = true;
+            return RSVP.resolve(0);
+          }
+        }]);
-      mockery.registerMock('./run', mockedRun);
+        mockery.registerMock('./run', mockedRun);
 
-      var output = [];
-      var outputFn = function(log) {
-        output.push(log);
-      };
+        var output = [];
+        var outputFn = function(log) {
+          output.push(log);
+        };
 
-      var mockedExit = function(code) {
-        code.should.equal(0, 'exits 0 when all scenarios succeed');
-      };
+        var mockedExit = function(code) {
+          code.should.equal(0, 'exits 0 when all scenarios succeed');
+        };
 
-      var TryEachTask = require('../../lib/tasks/try-each');
-      var tryEachTask = new TryEachTask({
-        ui: {writeLine: outputFn},
-        project: {root: tmpdir},
-        config: config,
+        var TryEachTask = require('../../lib/tasks/try-each');
+        var tryEachTask = new TryEachTask({
+          ui: {writeLine: outputFn},
+          project: {root: tmpdir},
+          config: config,
-        commandArgs: ['serve'],
-        dependencyManagerAdapters: [new StubDependencyAdapter()],
-        _exit: mockedExit
-      });
+          dependencyManagerAdapters: [new StubDependencyAdapter()],
+          _exit: mockedExit
+        });
 
-      writeJSONFile('bower.json', fixtureBower);
-      return tryEachTask.run(config.scenarios, {}).then(function() {
-        output.should.containEql('Scenario first: SUCCESS');
+        return tryEachTask.run(config.scenarios, {}).then(function() {
+          output.should.containEql('Scenario first: SUCCESS');
-        ranPassedInCommand.should.equal(true, 'Should run the passed in command');
+          output.should.containEql('Scenario different: SUCCESS');
+
+          ranDefaultCommand.should.equal(true, 'Should run the default command for one scenario');
+          ranScenarioCommand.should.equal(true, 'Should run the scenario command for one scenario');
-      }).catch(function(err) {
-        console.log(err);
-        true.should.equal(false, 'Assertions should run');
-      });
+        }).catch(function(err) {
+          console.log(err);
+          true.should.equal(false, 'Assertions should run');
+        });
+      });
+
     });
 
     it('sets EMBER_TRY_CURRENT_SCENARIO', function() {
Index: test/bower-adapter-test.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- test/bower-adapter-test.js	(date 1454649863000)
+++ test/bower-adapter-test.js	(revision )
@@ -38,13 +38,13 @@
     it('accounts for legacy format', function() {
       var scenarioDepSet = {
         dependencies: {
-          "ember": "components/ember#beta"
+          ember: 'components/ember#beta'
         },
         devDependencies: {
-          "ember-data": "~2.2.0"
+          'ember-data': '~2.2.0'
         },
         resolutions: {
-          "ember": "beta"
+          ember: 'beta'
         }
       };
       var results = new BowerAdapter({cwd: tmpdir})._getDependencySetAccountingForDeprecatedTopLevelKeys(scenarioDepSet);
@@ -55,23 +55,23 @@
       var scenarioDepSet = {
         bower: {
           dependencies: {
-            "ember": "components/ember#release"
+            ember: 'components/ember#release'
           },
           devDependencies: {
-            "ember-data": "~2.1.0"
+            'ember-data': '~2.1.0'
           },
           resolutions: {
-            "ember": "release"
+            ember: 'release'
           }
         },
         dependencies: {
-          "ember": "components/ember#beta"
+          ember: 'components/ember#beta'
         },
         devDependencies: {
-          "ember-data": "~2.2.0"
+          'ember-data': '~2.2.0'
         },
         resolutions: {
-          "ember": "beta"
+          ember: 'beta'
         }
       };
 
Index: lib/tasks/try-each.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- lib/tasks/try-each.js	(date 1454649863000)
+++ lib/tasks/try-each.js	(revision )
@@ -52,33 +52,53 @@
     return task.ScenarioManager.changeTo(scenario)
       .then(function(scenarioDependencyState) {
         process.env.EMBER_TRY_CURRENT_SCENARIO = scenario.name;
-
+        var command = task._determineCommandFor(scenario);
         var runResults = {
           scenario: scenario.name,
-          dependencyState: scenarioDependencyState
+          dependencyState: scenarioDependencyState,
+          command: command.join(' ')
         };
-        return task._runCommand().then(function(result) {
+
+        return task._runCommand({commandArgs: command, commandOptions: task._commandOptions()}).then(function(result) {
           runResults.result = result;
           return RSVP.resolve(runResults);
         });
       });
   },
 
-  _runCommand: function() {
+  _determineCommandFor: function(scenario) {
     var task = this;
-    return runCommand(task.project.root, this._commandArgs(), this._commandOptions());
+
+    if (task.commandArgs) {
+      return this.commandArgs;
+    }
+
+    if (scenario.command) {
+      return scenario.command.split(' ');
+    }
+
+    if (task.config.command) {
+      return task.config.command.split(' ');
+    }
+
+    return this._defaultCommandArgs();
   },
 
+  _runCommand: function(options) {
+    var task = this;
+    return runCommand(task.project.root, options.commandArgs, options.commandOptions);
+  },
+
   _commandOptions: function() {
     return this.commandOptions;
   },
 
-  _commandArgs: function() {
-    return this.commandArgs || ['test'];
+  _defaultCommandArgs: function() {
+    return ['ember', 'test'];
   },
 
   _printResults: function(results) {
-    new ResultSummary({ui: this.ui, results: results, command: this._commandArgs().join(' ')}).print();
+    new ResultSummary({ui: this.ui, results: results}).print();
   },
 
   _exitAsAppropriate: function(results) {
Index: test/npm-adapter-test.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- test/npm-adapter-test.js	(date 1454649863000)
+++ test/npm-adapter-test.js	(revision )
@@ -82,7 +82,7 @@
   describe('#_packageJSONForDependencySet', function() {
     it('changes specified dependency versions', function() {
       var npmAdapter = new NpmAdapter({cwd: tmpdir});
-      var packageJSON = { devDependencies: { 'ember-data': '2.2.1' }, dependencies: { 'ember-cli-babel': '5.0.0'} };
+      var packageJSON = { devDependencies: { 'ember-feature-flags': '1.0.0' }, dependencies: { 'ember-cli-babel': '5.0.0'} };
       var depSet =  { dependencies: { 'ember-cli-babel': '6.0.0' } };
 
       var resultJSON = npmAdapter._packageJSONForDependencySet(packageJSON, depSet);
@@ -92,12 +92,12 @@
 
     it('changes specified bower dev dependency versions', function() {
       var npmAdapter = new NpmAdapter({cwd: tmpdir});
-      var packageJSON = { devDependencies: { 'ember-data': '2.2.1' }, dependencies: { 'ember-cli-babel': '5.0.0'} };
-      var depSet =  { devDependencies: { 'ember-data': '2.3.0' } };
+      var packageJSON = { devDependencies: { 'ember-feature-flags': '1.0.0' }, dependencies: { 'ember-cli-babel': '5.0.0'} };
+      var depSet =  { devDependencies: { 'ember-feature-flags': '2.0.1' } };
 
       var resultJSON = npmAdapter._packageJSONForDependencySet(packageJSON, depSet);
 
-      resultJSON.devDependencies['ember-data'].should.equal('2.3.0');
+      resultJSON.devDependencies['ember-feature-flags'].should.equal('2.0.1');
     });
   });
 });
Index: test/utils/config-test.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- test/utils/config-test.js	(date 1454649863000)
+++ test/utils/config-test.js	(revision )
@@ -56,7 +56,7 @@
 
   it('uses specified options.configFile over project config/ember-try.js', function() {
     generateConfigFile('module.exports = { scenarios: [ { qux: "baz" }] };', 'non-default.js');
-    generateConfigFile('module.exports = { scenarios: [ { foo: "bar" }] };'); // should not be used
+    generateConfigFile('module.exports = { scenarios: [ { foo: "bar" }] };'); // Should not be used
 
     var config = getConfig({ project: project, configPath: 'config/non-default.js' });
     config.scenarios.should.have.length(1);
Index: lib/commands/try-each.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- lib/commands/try-each.js	(revision )
+++ lib/commands/try-each.js	(revision )
@@ -0,0 +1,29 @@
+'use strict';
+
+module.exports = {
+  name: 'try:each',
+  description: 'Runs each of the dependency scenarios specified in config with the specified command.' ,
+  works: 'insideProject',
+
+  availableOptions: [
+    { name: 'skip-cleanup',  type: Boolean, default: false },
+    { name: 'config-path', type: String, default: 'config/ember-try.js' }
+  ],
+
+  _getConfig: require('../utils/config'),
+  _TryEachTask: require('../tasks/try-each'),
+  run: function(commandOptions, rawArgs) {
+    var config = this._getConfig({
+      project: this.project,
+      configPath: commandOptions.configPath
+    });
+
+    var tryEachTask = new this._TryEachTask({
+      ui: this.ui,
+      project: this.project,
+      config: config
+    });
+
+    return tryEachTask.run(config.scenarios, commandOptions);
+  }
+};
Index: lib/utils/result-summary.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- lib/utils/result-summary.js	(date 1454649863000)
+++ lib/utils/result-summary.js	(revision )
@@ -19,6 +19,7 @@
         countFailed++;
       }
       task.ui.writeLine(colorAndMessage);
+      task.ui.writeLine('Command run: ' + scenario.command);
       task._printDependencyTable(scenario.dependencyState);
     });
 
@@ -29,8 +30,6 @@
     var task = this;
     task.ui.writeLine('');
     task.ui.writeLine('------ RESULTS ------');
-    task.ui.writeLine('');
-    task.ui.writeLine('Running command `' + task.command + '`');
     task.ui.writeLine('');
   },
   _printDependencyTable: function(dependencyStatus) {
Index: README.md
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- README.md	(date 1454649863000)
+++ README.md	(revision )
@@ -48,11 +48,11 @@
   ember try ember-1.11-with-ember-data-beta-16 serve
 ```
 
-When running in a CI environment where changes are discarded you can skip reseting your environment back to its original state by specifying --skip-cleanup as an option to ember try.
+When running in a CI environment where changes are discarded you can skip reseting your environment back to its original state by specifying --skip-cleanup=true as an option to ember try.
 *Warning: If you use this option and, without cleaning up, build and deploy as the result of a passing test suite, it will build with the last set of dependencies ember try was run with.*
 
 ```
-  ember try ember-1.11 test --skip-cleanup
+  ember try ember-1.11 test --skip-cleanup=true
 ```
 
 In order to use an alternate config path or to group various scenarios, you can use the `--config-path` option.
